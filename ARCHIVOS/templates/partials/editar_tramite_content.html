<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-pencil-square"></i>
                        Editar Tr치mite
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Papeleria:</strong> {{ tramite.papeleria.nombre }}
                        </div>
                        <div class="col-md-6">
                            <strong>Tr치mite Actual:</strong> {{ tramite.tramite }}
                        </div>
                    </div>

                    <form method="POST" hx-post="{{ url_for('papeleria.editar_tramite', tramite_id=tramite.id) }}"
                          hx-target="#main-dashboard-content" hx-swap="innerHTML" hx-indicator="#loading-indicator">
                        {{ form.hidden_tag() }}

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="tramite" class="form-label">Tipo de Tr치mite</label>
                                {{ form.tramite(class="form-select", id="tramite") }}
                                {% if form.tramite.errors %}
                                    <div class="text-danger small">
                                        {% for error in form.tramite.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3" id="manual-input" style="display: none;">
                                <label for="tramite_manual" class="form-label">Especificar Tr치mite</label>
                                {{ form.tramite_manual(class="form-control", placeholder="Ej: CERTIFICADO DE NACIMIENTO") }}
                                {% if form.tramite_manual.errors %}
                                    <div class="text-danger small">
                                        {% for error in form.tramite_manual.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="fecha" class="form-label">Fecha</label>
                                {{ form.fecha(class="form-control") }}
                                {% if form.fecha.errors %}
                                    <div class="text-danger small">
                                        {% for error in form.fecha.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="precio" class="form-label">Precio ($)</label>
                                {{ form.precio(class="form-control", step="0.01") }}
                                {% if form.precio.errors %}
                                    <div class="text-danger small">
                                        {% for error in form.precio.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="costo" class="form-label">Costo ($)</label>
                                {{ form.costo(class="form-control", step="0.01") }}
                                {% if form.costo.errors %}
                                    <div class="text-danger small">
                                        {% for error in form.costo.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="d-flex gap-2 justify-content-end">
                            <a href="{{ url_for('papeleria.ver_papeleria', papeleria_id=tramite.papeleria_id) }}"
                               class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <span id="loading-indicator" class="htmx-indicator">
                                    <i class="bi bi-arrow-repeat"></i> Procesando...
                                </span>
                                <span class="htmx-non-indicator">
                                    <i class="bi bi-check-circle"></i> Guardar Cambios
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    (function(){
        function toggleManualInput() {
            const tramiteSelect = document.getElementById('tramite');
            const manualInput = document.getElementById('manual-input');
            if (!tramiteSelect || !manualInput) return;
            manualInput.style.display = (tramiteSelect.value === 'OTRO') ? 'block' : 'none';
        }
        document.addEventListener('DOMContentLoaded', toggleManualInput);
        document.addEventListener('htmx:afterSettle', toggleManualInput);
        document.getElementById('tramite')?.addEventListener('change', toggleManualInput);
        toggleManualInput();
    })();
</script>
