<!-- Toast de confirmación - visible si registro_exitoso -->
<div id="tramite-success-toast" class="alert alert-success mb-3 shadow-sm {% if not registro_exitoso %}d-none{% endif %}" role="alert">
	<div class="d-flex align-items-center">
		<div class="me-3" style="font-size: 1.75rem;">
			<i class="bi bi-check-circle-fill text-success"></i>
		</div>
		<div class="flex-grow-1">
			<strong class="d-block">¡Trámite registrado!</strong>
			<small class="text-muted">El formulario está listo para otro registro</small>
		</div>
		<button type="button" class="btn-close ms-2" onclick="this.closest('.alert').classList.add('d-none')" aria-label="Cerrar"></button>
	</div>
</div>

<form id="form-registrar-tramite"
	hx-post="{{ url_for('papeleria.registrar_tramite') }}"
	hx-target="#registrar-tramite-container"
	hx-swap="innerHTML"
	hx-indicator="#tramite-loading">
	{% include 'form_tramite_fields.html' %}
	{{ form_tramite.hidden_tag() }}
	<div class="position-relative d-inline-block w-100">
		<button type="submit" id="btn-registrar-tramite" class="btn btn-primary w-100 btn-lg position-relative overflow-hidden">
			<span class="htmx-indicator" id="tramite-loading">
				<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
				Procesando...
			</span>
			<span class="htmx-hide-on-request"><i class="bi bi-plus-circle me-1"></i>Registrar Trámite</span>
		</button>
	</div>
</form>

<script>
(function() {
    // Asegurar que HTMX procese el nuevo contenido
    if (typeof htmx !== 'undefined') {
        htmx.process(document.getElementById('form-registrar-tramite'));
    }
    
    // Si fue registro exitoso, ejecutar feedback
    {% if registro_exitoso %}
    // Vibración táctil
    if ('vibrate' in navigator) {
        navigator.vibrate([50, 30, 50]);
    }
    // Scroll al formulario en móvil
    if (window.innerWidth < 992) {
        var container = document.getElementById('registrar-tramite-container');
        if (container) {
            setTimeout(function() {
                container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
    }
    // Auto-ocultar toast después de 5 segundos
    setTimeout(function() {
        var toast = document.getElementById('tramite-success-toast');
        if (toast && !toast.classList.contains('d-none')) {
            toast.style.transition = 'opacity 0.3s ease';
            toast.style.opacity = '0';
            setTimeout(function() { 
                toast.classList.add('d-none'); 
                toast.style.opacity = '1';
            }, 300);
        }
    }, 5000);
    {% endif %}
})();
</script>
