<div id="registrar-tramite-container">

<!-- Estilos para el indicador de carga -->
<style>
/* Clase activa durante la petición - aplicada por CSS y JS como respaldo */
#form-registrar-tramite.htmx-request #tramite-loading,
#form-registrar-tramite.is-loading #tramite-loading { display: inline-flex !important; }
#form-registrar-tramite.htmx-request #tramite-btn-text,
#form-registrar-tramite.is-loading #tramite-btn-text { display: none !important; }
#form-registrar-tramite.htmx-request #btn-registrar-tramite,
#form-registrar-tramite.is-loading #btn-registrar-tramite { opacity: 0.7; pointer-events: none; }
</style>

<!-- Toast de confirmación (oculto inicialmente) -->
<div id="tramite-success-toast" class="alert alert-success d-none mb-3 shadow-sm" role="alert">
	<div class="d-flex align-items-center">
		<div class="me-3" style="font-size: 1.75rem;">
			<i class="bi bi-check-circle-fill text-success"></i>
		</div>
		<div class="flex-grow-1">
			<strong class="d-block">¡Trámite registrado!</strong>
			<small class="text-muted">El formulario está listo para otro registro</small>
		</div>
		<button type="button" class="btn-close ms-2" onclick="this.closest('.alert').classList.add('d-none')" aria-label="Cerrar"></button>
	</div>
</div>

<form id="form-registrar-tramite"
		hx-post="{{ url_for('papeleria.registrar_tramite') }}"
		hx-target="#registrar-tramite-container"
		hx-swap="innerHTML"
		hx-disabled-elt="#btn-registrar-tramite">
	{% include 'form_tramite_fields.html' %}
	{{ form_tramite.hidden_tag() }}
	<div class="position-relative d-inline-block w-100">
		<button type="submit" id="btn-registrar-tramite" class="btn btn-primary w-100 btn-lg position-relative overflow-hidden">
			<span id="tramite-loading" style="display: none;">
				<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
				Procesando...
			</span>
			<span id="tramite-btn-text"><i class="bi bi-plus-circle me-1"></i>Registrar Trámite</span>
		</button>
	</div>
</form>

<script>
// Respaldo JavaScript para móviles donde htmx-request puede no funcionar bien
(function() {
    var form = document.getElementById('form-registrar-tramite');
    if (form && !form._mobileFixApplied) {
        form._mobileFixApplied = true;
        
        // Usar evento submit nativo como respaldo
        form.addEventListener('submit', function(e) {
            // No prevenir default - dejar que HTMX maneje
            this.classList.add('is-loading');
            console.log('[TRAMITE-MOBILE] Submit detectado, clase is-loading agregada');
        });
        
        // Escuchar htmx:beforeRequest como respaldo adicional
        form.addEventListener('htmx:beforeRequest', function(e) {
            this.classList.add('is-loading');
            console.log('[TRAMITE-MOBILE] htmx:beforeRequest, clase is-loading agregada');
        });
    }
})();
</script>
</div>