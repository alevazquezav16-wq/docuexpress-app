<div class="mb-3">
    {{ form_tramite.papeleria_id.label(class="form-label") }}
    {{ form_tramite.papeleria_id(class="form-select" + (" is-invalid" if form_tramite.papeleria_id.errors else ""), id="papeleria") }}
    {% for error in form_tramite.papeleria_id.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
</div>
<div class="mb-3">
    {{ form_tramite.tramite.label(class="form-label") }}
    {{ form_tramite.tramite(class="form-select" + (" is-invalid" if form_tramite.tramite.errors else ""), id="tramite") }}
    {% for error in form_tramite.tramite.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
</div>
<div class="mb-3" id="tramiteManualContainer" style="display: none;">
    {{ form_tramite.tramite_manual.label(class="form-label") }}
    {{ form_tramite.tramite_manual(class="form-control" + (" is-invalid" if form_tramite.tramite_manual.errors else ""), placeholder="Escribe el nombre del trámite") }}
    {% for error in form_tramite.tramite_manual.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
</div>
<div class="row">
    <div class="col-md-6 mb-3">
        {{ form_tramite.precio.label(class="form-label") }}
        <small class="text-muted">(auto-completado, puedes editarlo)</small>
        {{ form_tramite.precio(class="form-control" + (" is-invalid" if form_tramite.precio.errors else ""), step="0.01", id="precio", placeholder="Se autocompleta según la papelería") }}
        {% for error in form_tramite.precio.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
    </div>
    <div class="col-md-6 mb-3">
        {{ form_tramite.costo.label(class="form-label") }}
        <small class="text-muted">(auto-completado, puedes editarlo)</small>
        {{ form_tramite.costo(class="form-control" + (" is-invalid" if form_tramite.costo.errors else ""), step="0.01", id="costo", placeholder="Se autocompleta según configuración") }}
        {% for error in form_tramite.costo.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
    </div>
</div>
<div class="row">
    <div class="col-md-6 mb-3">
        <label for="cantidad" class="form-label d-flex align-items-center gap-1">
            {{ form_tramite.cantidad.label.text }}
            <i class="bi bi-info-circle text-primary" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus" data-bs-content="Indica cuántos trámites iguales deseas registrar de una sola vez."></i>
        </label>
        <div class="input-group justify-content-center" style="max-width: 220px; margin: 0 auto;">
            <button type="button" class="btn btn-outline-secondary btn-lg px-3" style="font-size:1.5rem;" onclick="stepCantidad(-1)"><i class="bi bi-dash"></i></button>
            <input type="number" id="cantidad" name="cantidad" min="1" step="1" class="form-control text-center form-control-lg mx-2" style="font-size:2rem; max-width: 100px; border-radius: 1.5rem;" value="{{ form_tramite.cantidad.data or 1 }}" oninput="validateCantidadInput()" onwheel="wheelCantidad(event)" ontouchstart="touchCantidadStart(event)" ontouchmove="touchCantidadMove(event)">
            <button type="button" class="btn btn-outline-secondary btn-lg px-3" style="font-size:1.5rem;" onclick="stepCantidad(1)"><i class="bi bi-plus"></i></button>
        </div>
        <div class="text-center mt-1">
            <small class="text-muted">Desliza, toca o usa +/- para elegir</small>
        </div>
        {% for error in form_tramite.cantidad.errors %}<div class="invalid-feedback fw-bold">{{ error }}</div>{% endfor %}
        <script>
        function stepCantidad(delta) {
            var input = document.getElementById('cantidad');
            var val = parseInt(input.value) || 1;
            val += delta;
            if (val < 1) val = 1;
            input.value = val;
            input.dispatchEvent(new Event('input'));
        }
        function validateCantidadInput() {
            var input = document.getElementById('cantidad');
            if (parseInt(input.value) < 1 || isNaN(parseInt(input.value))) input.value = 1;
        }
        function wheelCantidad(e) {
            e.preventDefault();
            stepCantidad(e.deltaY < 0 ? 1 : -1);
        }
        // Soporte touch para deslizar arriba/abajo
        let touchStartY = null;
        function touchCantidadStart(e) {
            if (e.touches && e.touches.length === 1) {
                touchStartY = e.touches[0].clientY;
            }
        }
        function touchCantidadMove(e) {
            if (touchStartY !== null && e.touches && e.touches.length === 1) {
                let deltaY = e.touches[0].clientY - touchStartY;
                if (Math.abs(deltaY) > 20) {
                    stepCantidad(deltaY < 0 ? 1 : -1);
                    touchStartY = e.touches[0].clientY;
                }
            }
        }
        </script>
    </div>
    <div class="col-md-6 mb-3">
        {{ form_tramite.fecha.label(class="form-label") }}
        {{ form_tramite.fecha(class="form-control" + (" is-invalid" if form_tramite.fecha.errors else "")) }}
        {% for error in form_tramite.fecha.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
    </div>
</div>